<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cy.share.mapper.LogMapper">
    <cache/>
    <resultMap id="BaseResultMap" type="com.cy.share.pojo.Log">
            <id property="id" column="id" />
            <result property="picurl" column="picurl" />
            <result property="info" column="info" />
            <result property="title" column="title" />
            <result property="author" column="author" />
            <result property="createTime" column="createTime" />
            <result property="updateTime" column="updateTime" />
            <result property="love" column="love" />
            <result property="version" column="version" />
            <result property="deleted" column="deleted" />
    </resultMap>

    <sql id="Base_Column_List">
        id,picurl,info,title,author,createTime,
        updateTime,love,version,deleted
    </sql>
    <insert id="add">
        INSERT INTO log (
            picurl, info, title, author, createTime,
            updateTime, love, version, deleted
        ) VALUES (
                     #{picurl}, #{info}, #{title}, #{author}, #{createTime},
                     #{updateTime}, #{love}, #{version}, #{deleted}
                 )
    </insert>
    <update id="updatebyId">
        UPDATE log
        <set>
            <!-- 仅当字段非空时才更新 -->
            <if test="picurl != null and picurl != ''">
                picurl = #{picurl},
            </if>
            <if test="title != null and title != ''">
                title = #{title},
            </if>
            <if test="love != null and love != ''">
                love = #{love},
            </if>
            <if test="author != null and author != ''">
                author = #{author},
            </if>
            <if test="info != null and info != ''">
                info = #{info},
            </if>
            updateTime = NOW(),
        </set>
        WHERE
        id = #{id}
        AND deleted = 1;
    </update>
    <select id="queryLogList" resultType="com.cy.share.vo.LogListVo">
        SELECT
        l.id, l.title,l.picurl,l.author,
        l.love,u.avatorurl as authorAvatar
        FROM log l
        LEFT JOIN user u ON l.author = u.name
        <where>
            l.deleted = 1
            AND u.deleted =1
            <if test="key != null and key.trim() != ''">
                AND l.author = #{key}
            </if>
        </where>
        ORDER BY l.createTime DESC
        LIMIT #{x}, #{y}
    </select>
    <select id="findById" resultType="com.cy.share.vo.LogDetailVo">
        SELECT
            l.picurl,
            l.title,
            u.avatorurl AS avatarurl,
            l.love,
            l.author,
            l.info,
            l.createTime,
            l.updateTime
        FROM
            log l
                LEFT JOIN
            user u ON l.author = u.name
        WHERE
            l.id = #{id}
          AND l.deleted = 1
          AND u.deleted = 1;
    </select>
    <select id="editById" resultType="com.cy.share.vo.LogEditVo">
        SELECT
            picurl,
            title,
            author,
            info,
            love
        FROM
            log
        WHERE
            id = #{id}
          AND deleted = 1;
    </select>
</mapper>
